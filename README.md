# Modified version of Light-DehazeNet from [Light-DehazeNet: A Novel Lightweight CNN Architecture for Single Image Dehazing](https://ieeexplore.ieee.org/abstract/document/9562276)

## Introduction
This repo contains the implementation of LD-Net, LD-Net Lite, and Color Attenuation Prior (CAP). 

## Installation

This code is written with Anaconda python 3.9. Install the Anaconda python 3.9 and clone the repo with the following command:
```
git clone https://github.com/virgantara/Light-DehazeNet.git
cd Light-DehazeNet
```

### Dependencies
This code requires the following libraries, install these libraries before testing th code. 
- torch==1.9.1
- torchvision==0.10.1
- numpy==1.19.2
- PIL==8.2.0
- matplotlib==3.3.4

run ```pip install -r requirements.txt``` to install all the dependencies. 

### Training Dataset
For training we have used the Synthetic Hazy Dataset generated by [Boyi Li](https://sites.google.com/site/boyilics/website-builder/project-page) and his team for single image dehazing task. The dataset can be downloaded using the following links. 

- The synthetic hazy images [training set](https://drive.google.com/file/d/17ZWJOpH1AsYQhoqpWR6PK61HrUhArdAK/view)
- The original images [training set](https://drive.google.com/file/d/1Sz5ZFFZXo3sY85R3v7yJa6W6riDGur46/view)

The structure of the dataset directory should be as follows:
```
data
├── original_images
│   ├── images
│       ├── data
│       ├── NYU2_1.jpg
│       ├── NYU2_2.jpg
│       ├── NYU2_3.jpg
│       ├── .....
├── training_images
│   ├── data
│       ├── data
│       ├── NYU2_1_1_2.jpg
│       ├── NYU2_1_1_3.jpg
│       ├── NYU2_1_2_1.jpg
│       ├── .....
   
```

## Training
Run the following command to retrain the LD-Net model on Synthic hazy images from NYU2 Hazy dataset.
```
python run_experiment.py -th data/training_images/data/ -to data/original_images/images/ -e 60 -lr 0.0001
```

## Inferencing 
For testing purpose, we provide two different inferencing scripts namely single_test_inference.py and muliple_test_inference.py. Here single_test_inference.py performs dehazing on single image, whereas muliple_test_inference.py dehaze a batch of images at once as per user's requirements.

### Single_Image_Inferencing 
To run the single_test_inference.py, type the following command in terminal:
```cmd
python single_test_inference.py -i query_hazy_images/outdoor_synthetic/soh5.jpg
```

To run LDlite-Net single
```cmd
python m_single_test_inference.py -i query_hazy_images/outdoor_synthetic/soh5.jpg --model=ldnet_lite_jit.pt --output_file=dehazed_ldnetlite_jit.png
```

To run LDlite-Net video
```cmd
python run_ldnet_video.py -i data/video_sooko.mp4 -o dehazed_ldnet.avi -m ldnet_lit_jit.pt --width 224 --height 224
```

To run CAP video
```cmd
python CAP/cap_video_sidebyside.py -i data/video_sooko.mp4 -o data/dehazed_output_sideby_side.mp4 --width 640 --height 480
```
### Multiple_Images_Inferencing 
To run the muliple_test_inference.py, type the following command in terminal:
```
python muliple_test_inference.py -td query_hazy_images/outdoor_natural/
```

## Disclamier
For any details regarding LD-Net, follow its original github repo [here](https://github.com/hayatkhan8660-maker/Light-DehazeNet)